<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"/>
<link rel="import" href="../../bower_components/paper-button/paper-button.html"/>
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">


<dom-module id="my-emotion">
  <template>
    <style include="shared-styles">
      paper-slider {
        width: 100%;
      }
    </style>

    <h2 class="page-title">{{title}}</h2>
    <!--<h3>You can enter your text below</h3>-->

    <paper-textarea label="Please enter your text here. Click the button below to convert your text."
                    value="{{searchCriterion2}}"></paper-textarea>

    <div style="text-align:center;">
      <paper-button raised on-click="convertToEmotion">Convert to {{title}}!</paper-button>
    </div>

    <h3>Results</h3>
    <div>

      <h4>Emotion:</h4>
      <span>Anticipation: {{emotions.anticipation}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1 value="{{emotions.anticipation}}f"></paper-slider>
      <span>Joy: {{emotions.joy}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.joy}}f"></paper-slider>
      <span>Sadness: {{emotions.sadness}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.sadness}}f"></paper-slider>
      <span>Disgust: {{emotions.disgust}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.disgust}}f"></paper-slider>
      <span>Anger: {{emotions.anger}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.anger}}f"></paper-slider>
      <span>Surprise: {{emotions.surprise}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.surprise}}f"></paper-slider>
      <span>Fear: {{emotions.fear}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.fear}}f"></paper-slider>
      <span>Trust: {{emotions.trust}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{emotions.trust}}f"></paper-slider>

      <h4>Sentiment:</h4>
      <span>Positive: {{sentiments.positive}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{sentiments.positive}}f"></paper-slider>
      <span>Negative: {{sentiments.negative}}</span><br>
      <paper-slider pin="true" step="0.1" snaps="false" min=0 max=1
                    value="{{sentiments.negative}}f"></paper-slider>
    </div>

    <h3>JSON output</h3>
    <code>[[printedJson]]</code>

    <iron-ajax id="emotion"
               url="http://augment.cs.kuleuven.be/paris/api/emotion"
               method="POST"
               handle-as="json"
               content-type="text/plain"
               last-response="{{data}}"
               params="{{ajaxParams}}"
               on-response="responseHandler"
               on-error="handleError"></iron-ajax>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'my-emotion',

        properties: {
          ajaxParams: {
            type: String,
            computed: 'buildSearchRequest(searchCriterion2)'
          }
        },

        ready: function () {
          this.title = "Emotion";
          this.emotions = {anticipation: 0, joy: 0, sadness: 0, disgust: 0, anger: 0, surprise: 0, fear: 0, trust: 0};
          this.sentiments = {positive: 0, negative: 0};
          this.printedJson = "No JSON output available yet.";
        },

        buildSearchRequest: function (searchCriterion2) {
          this.$.emotion.body = searchCriterion2;
        },

        convertToEmotion: function () {
          this.$.emotion.generateRequest();
        },

        handleError: function (e) {
          alert('Whoops! ' + e.detail.error + " See console for more detailed error message.");
          console.log(e.detail);
        },

        responseHandler: function (e, detail) {
          this.emotionJSON = detail.xhr.response.emotion;
          this.sentiments = detail.xhr.response.sentiment;
          for (var p in this.emotionJSON) {
            this.emotionJSON[p] = this.emotionJSON[p].toFixed(3);
          }
          this.emotions = this.emotionJSON;
          this.printedJson = JSON.stringify(detail.xhr.response, null, '\t');
//          this.$.jsoncode(this.printedJson);
        }

      });
    })();
  </script>
</dom-module>
